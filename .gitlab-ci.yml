image: bscstorage/cargo:0.2.0-wip

stages:
  - build
  - test

variables:
  PREFIX:
    /usr/local
  LD_LIBRARY_PATH: "/usr/lib/:/usr/lib64:/usr/local/lib:/usr/local/lib64"
  PKG_CONFIG_PATH: "/usr/lib/pkgconfig:/usr/lib64/pkgconfig:/usr/local/lib/pkgconfig:/usr/local/lib64/pkgconfig:/usr/lib64/openmpi/lib/pkgconfig"

before_script:
  - source /etc/profile.d/modules.sh
  - module load mpi

release:
  stage: build
  script:
    - cmake --preset ci-release
    - cmake --build builds/ci-release -j$(nproc) --target install

debug:
  stage: build
  script:
    - cmake --preset ci-debug
    - cmake --build builds/ci-debug -j$(nproc) --target install

sast:
  stage: test
  before_script: []
  needs: []
include:
  - template: Security/SAST.gitlab-ci.yml
